{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Регистрация</title>
    <!-- Иконки -->
    <link rel="icon" href="{% static 'img/favicon.png' %}" type="image/png">
    <link rel="shortcut icon" href="{% static 'img/favicon.ico' %}" type="image/x-icon">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Стили -->
    <link rel="stylesheet" href="{% static 'users/css/register.css' %}">
    <!-- Select2 CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/css/select2.min.css" rel="stylesheet" />
</head>
<body>
    <div class="login-container">
        <div class="login-box">
            <div class="logo">
                <img src="{% static 'img/logo.png' %}" alt="Логотип">
            </div>
            <div class="login-content">
                <h2>Создать аккаунт</h2>
                <form method="post" novalidate>
                    {% load widget_tweaks %}
                    {% csrf_token %}
                    <!-- Автоматическая сетка без ручного разделения -->
                    <div class="form-grid">
                        <!-- Все поля идут последовательно -->
                        <div class="input-group">
                            <label for="{{ form.last_name.id_for_label }}">Фамилия<span class="star">*</span></label>
                            {{ form.last_name }}
                            <span class="input-icon"><i class="fas fa-user"></i></span>
                        </div>
                        <div class="input-group">
                            <label for="{{ form.first_name.id_for_label }}">Имя<span class="star">*</span></label>
                            {{ form.first_name }}
                            <span class="input-icon"><i class="fas fa-user"></i></span>
                        </div>
                        <div class="input-group">
                            <label for="{{ form.middle_name.id_for_label }}">Отчество</label>
                            {{ form.middle_name }}
                            <span class="input-icon"><i class="fas fa-user"></i></span>
                        </div>
                        <div class="input-group">
                            <label for="{{ form.email.id_for_label }}">Email<span class="star">*</span></label>
                            {{ form.email }}
                            <span class="input-icon"><i class="fas fa-envelope"></i></span>
                        </div>
                        <div class="input-group">
                            <label for="{{ form.password1.id_for_label }}">Пароль<span class="star">*</span></label>
                            {{ form.password1 }}
                            <span class="input-icon"><i class="fas fa-lock"></i></span>
                        </div>
                        <div class="input-group">
                            <label for="{{ form.password2.id_for_label }}">Подтвердите пароль<span class="star">*</span></label>
                            {{ form.password2 }}
                            <span class="input-icon"><i class="fas fa-lock"></i></span>
                        </div>
                        <div class="input-group">
                            <label for="id_phone">Телефон<span class="star">*</span></label>
                            <input 
                                type="text" 
                                name="{{ form.phone.html_name }}" 
                                id="id_phone" 
                                class="phone-input" 
                                placeholder="+7-___-___-__-__"
                                value="{{ form.phone.value|default_if_none:'' }}"
                            >
                            <span class="input-icon"><i class="fas fa-phone"></i></span>
                        </div>
                        <div class="input-group">
                            <label for="{{ form.position.id_for_label }}">Должность<span class="star">*</span></label>
                            {{ form.position }}
                            <span class="input-icon"><i class="fas fa-briefcase"></i></span>
                        </div>
                        <div class="input-group birth-date">
                            <label for="{{ form.birth_date.id_for_label }}">Дата рождения</label>
                            {{ form.birth_date }}
                            <span class="input-icon"><i class="fas fa-calendar-alt"></i></span>
                        </div>
                        <div class="input-group" style="align-items: center;">
                            <label for="id_department">Организация / Подразделение<span class="star">*</span></label>
                            <div class="input-organization">
                                <select id="id_department"
                                        name="{{ form.department.html_name }}"
                                        class="form-select change-department"
                                        style="width: 100%;">
                                    <option value="">—</option>
                                    {% for dept in form.fields.department.queryset %}
                                        <option value="{{ dept.pk }}"
                                                {% if form.department.value|stringformat:"s" == dept.pk|stringformat:"s" %}selected{% endif %}>
                                            {{ dept.organization.name }} / {{ dept.name }}
                                        </option>
                                    {% endfor %}
                                </select>
                                <span class="input-icon"><i class="fas fa-building"></i></span>
                            </div>
                        </div>
                        <div class="input-group">
                            <label for="{{ form.role.id_for_label }}">Роль<span class="star">*</span></label>
                            {{ form.role }}
                            <span class="input-icon"><i class="fas fa-star"></i></span>
                        </div>
                        <div class="input-group">
                            <label for="{{ form.location.id_for_label }}">Локация<span class="star">*</span></label>
                            {{ form.location }}
                            <span class="input-icon"><i class="fas fa-map-marker-alt"></i></span>
                        </div>
                    </div>
                    <!-- Контейнер для всех ошибок -->
                    <div class="all-errors-container">
                        <!-- Ошибки от Django -->
                        {% if form.non_field_errors %}
                            {% for error in form.non_field_errors %}
                                <div class="all-error-message">{{ error }}</div>
                            {% endfor %}
                        {% endif %}
                        
                        <!-- Ошибки полей от Django -->
                        {% for field in form %}
                            {% for error in field.errors %}
                                <div class="all-error-message">{{ field.label }}: {{ error }}</div>
                            {% endfor %}
                        {% endfor %}
                    </div>
                    <!-- Переход на авторизацию -->
                    <div class="form-check mb-3 text-center">
                        <span>Есть аккаунт?</span>
                        <a href="{% url 'login' %}" class="link-light fw-medium">
                            Авторизация
                        </a>
                    </div>
                    <!-- Кнопка -->
                    <div class="btn-container">
                        <button type="submit" class="btn-login">Зарегистрироваться</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <!-- Подключаем jQuery -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.0/jquery.min.js"></script>
    <!-- Подключаем плагин Inputmask -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.9/jquery.inputmask.min.js"></script>
    <!-- Select2 JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.1.0-rc.0/js/select2.min.js"></script>
    <!-- Скрипты кастомные -->
    <script src="{% static 'users/js/register.js' %}"></script>
</body>
</html>